$().ready(function () {
    var roleArray;
    var roleImgArray = new Array();
    var chooseAvatar = {
        roleId: 9999
        //roleId
        //imgId
        //path
        //roleName
    };
    var imgScale = 1;
    var boxJsonArray = new Array();
    var cen = 0;
    var kqOptions = {
        isYHZ: false
    }
    var roleObj = {
        type: "img",
        index: 5,
        //content: 1,
        content: "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/4gHYSUNDX1BST0ZJTEUAAQEAAAHIAAAAAAQwAABtbnRyUkdCIFhZWiAH4AABAAEAAAAAAABhY3NwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAA9tYAAQAAAADTLQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlkZXNjAAAA8AAAACRyWFlaAAABFAAAABRnWFlaAAABKAAAABRiWFlaAAABPAAAABR3dHB0AAABUAAAABRyVFJDAAABZAAAAChnVFJDAAABZAAAAChiVFJDAAABZAAAAChjcHJ0AAABjAAAADxtbHVjAAAAAAAAAAEAAAAMZW5VUwAAAAgAAAAcAHMAUgBHAEJYWVogAAAAAAAAb6IAADj1AAADkFhZWiAAAAAAAABimQAAt4UAABjaWFlaIAAAAAAAACSgAAAPhAAAts9YWVogAAAAAAAA9tYAAQAAAADTLXBhcmEAAAAAAAQAAAACZmYAAPKnAAANWQAAE9AAAApbAAAAAAAAAABtbHVjAAAAAAAAAAEAAAAMZW5VUwAAACAAAAAcAEcAbwBvAGcAbABlACAASQBuAGMALgAgADIAMAAxADb/2wBDACgcHiMeGSgjISMtKygwPGRBPDc3PHtYXUlkkYCZlo+AjIqgtObDoKrarYqMyP/L2u71////m8H////6/+b9//j/2wBDASstLTw1PHZBQXb4pYyl+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj/wAARCAUjBDgDASIAAhEBAxEB/8QAGgABAAMBAQEAAAAAAAAAAAAAAAMEBQIBBv/EADEQAQACAgEDAwQBBAMAAwADAAABAgMRBBIhMQVBURMiMmFxFEKBkRUjoTNSsUNT4f/EABgBAQEBAQEAAAAAAAAAAAAAAAABAgME/8QAIBEBAQEBAAMBAQEBAQEAAAAAAAERAhIhMUFRAxMyYf/aAAwDAQACEQMRAD8A2QAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA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AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP//Z",
        roleId: 1,
        imgId: 3,
        name: "米雪儿",
        mark: "mxr_sf",
        base64: "",
        path: " images/roleImages/mxr_sf.png",
        rtx: "rtx"
    }
    var Keys = "GuGuTalk";
    Init();

    $(document).keyup(function (e) {
        if (e.keyCode == 45) {
        }
        if (e.keyCode == 36) {
            chooseAvatar = '';
        }
        if (e.ctrlKey && e.which == 13) {
            aside();
        }
        if (e.keyCode == 36) { //enter发送
            wirte();
        }

    });

    /**
     * 读取自定义设置
     */
    function LoadSetOptions() {
        //移动端访问
        var userAgent = navigator.userAgent;
        loadSetList().then(res => {
            if (res != undefined) {
                updateSetList(res);
            }

        })
        // 判断是否包含移动设备关键字，例如 "Android"、"iPhone"、"iPad" 等
        if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(userAgent)) {
            // 在移动端执行的代码
            console.log("移动端访问");
            $("#ALLPM").parent().addClass("n");
            $(".bodyN").addClass("margin0");
        } else {
            // 在非移动端执行的代码
            console.log("非移动端访问");
        }
    }
    //临时的导出存档
    $("#dccd").click(function () {
        getTempJson().then(res => {
            var blob = new Blob([JSON.stringify(res)], { type: "text/plain;charset=utf-8" });
            var link = document.createElement('a');
            link.download = '当前编辑内容';
            link.href = URL.createObjectURL(blob);
            link.click();
        })

    })
    //临时的导入存档
    $("#drcd").click(function () {
        var link = document.createElement("input");
        var jq = $(link);
        var reader = new FileReader();
        var imgObj;
        jq.attr({ "type": "file", "accept": "text/plain" });
        jq.on("change", function () {
            var imgP = $(this);
            imgObj = imgP[0].files[0];
            reader.onload = function (e) {
                var content = e.target.result;
                console.log(content);
                if (confirm("导入存档会导致当前编辑内容被替换，是否导入？")) {
                    if (content.indexOf("boxJson") >= 0) {
                        var json = JSON.parse(content);
                        LSupdateTempJson(json).then(res => {
                            loadBoxData();
                        })
                    } else {
                        alert("文件格式错误");
                    }


                }
            };
            reader.readAsText(imgObj);

        })

        jq.click();


    })
    //gugutalk边上的小提示
    $(".whDiv1").click(function () {
        alert(`部分浏览器无法保存生成的图片，目前已查明的有uc、夸克、小米自带浏览器，如果碰上无法保存图片的情况可以点击左侧工具栏的导出存档功能，在新的浏览器上导入存档，另外，导出的只是当前编辑内容，考虑到存档覆盖的问题全部存档的导出功能还在制作中`)
    })
    $(".send").click(function () {
        wirte();
    });
    $("#text").keydown(function (event) {
        //var msgInput=$(this).val()
        //兼容Chrome和Firefox
        event = (event) ? event : ((window.event) ? window.event : "");
        var keyCode = event.keyCode ? event.keyCode : (event.which ? event.which : event.charCode);
        if (event.shiftKey && event.keyCode == 13) { //ctrl+enter换行
            $(this).css("height", $(this).css("height") + 24)// 获取textarea数据进行 换行
        } else if (event.ctrlKey && event.keyCode == 13) {
            //发送旁白
            aside();
            event.preventDefault();//禁止回车的默认换行
        } else if (keyCode == 13) { //enter发送
            wirte();
            event.preventDefault();//禁止回车的默认换行
        }
    })
    function wirte() {
        var json = new Object();
        $("#text").css("height", "1.35rem");
        var text = $("#text").val();
        var value;

        var base64;
        var avatars = $("img[class*='imgd']");
        var a = $("div[class*='roleOverall']");
        // if (avatars.length <= 0) {
        //     value = 9999;
        // } else {
        //     value = chooseAvatar.roleId
        //     base64 = getBase64(chooseAvatar.roleId);
        // }
        // var newTalk = '';
        if (text != "") {
            // if (avatars.length <= 0) {
            //     value = 9999;
            // } else {
            //     value = chooseAvatar.roleId
            //     base64 = getBase64(chooseAvatar.roleId);
            // }
            // var newTalk = '';

            // json.index = cen;
            // json.content = text;
            // if (value == 9999) {
            //     json.roleId = 9999;
            //     json.mark = '9999';
            // } else {
            //     json.roleId = chooseAvatar.roleId,
            //         json.imgId = chooseAvatar.imgId,
            //         json.name = chooseAvatar.name,
            //         json.content = text,
            //         json.mark = chooseAvatar.mark;
            //     if (chooseAvatar.roleId != undefined) {
            //         json.base64 = '';
            //         json.path = chooseAvatar.path;
            //     } else {
            //         if (getNewRoleType(chooseAvatar.roleId) == "newRole" || getNewRoleType(chooseAvatar.roleId) == null) {
            //             json.base64 = base64;
            //         }
            //         json.path = chooseAvatar.path
            //     }
            // }
            json = getRoleJson("txt");
            console.log(json, "json");
            newTalk = createHtml(json)
            insertOrContinue(newTalk, json);
            var text = document.getElementById("text");
            autoTextarea(text);// 调用
        }
    }
    //
    /**
     * 传入参数，根据情况插入对话或者继续对话
     * @param newObj 插入的对话对象
     * @param {*} talk 生成的html
     */
    function insertOrContinue(newTalk, newObj) {
        var that = $(".editOpen");
        if (that.length == 0) {
            $("#box").append(newTalk);
            boxJson(newObj);
            ToBtm();
        } else {
            var index = that.find(".gu").data("index");
            var previousArray = new Array();
            var afterArray = new Array();
            for (let i = 0; i < boxJsonArray.length; i++) {
                if (boxJsonArray[i].index == index) {
                    previousArray = boxJsonArray.slice(0, i);
                    previousArray.push(newObj);
                    afterArray = boxJsonArray.slice(i, boxJsonArray.length);
                    boxJsonArray = previousArray.concat(afterArray);
                    break;
                }
            }
            insertTalk(boxJsonArray).then(res => {
                // console.log(newObj,res);
                that.before(newTalk);
            })
        }
        $("#text").val("");
        cen++;
    }
    //传入参数生成html
    /**
     * 传入一个对象
     * new objec{
     * 
     * }
     * @param {*} listOne  参数类
     */
    function createHtml(listOne) {
        var type;//1:继续 2:插入
        var editOpen = $(".editOpen").prev().find('.gu');
        var lastDc = $("#box").children().last(".dc").find('.gu');
        var tdc;
        listOne.rtx = "";
        if ($(".imgd").length <= 0 && kqOptions.isYHZ) {
            listOne = roleObj
        }
        //var replyTdc;
        if ($(".editOpen").length == 0) {
            type = 1;
            tdc = lastDc;
            //replyTdc = replylastDc;

        } else {
            type = 2;
            tdc = editOpen;
            //replyTdc = replyEditOpen;
        }
        var html = '';
        var a = 'data:image'
        switch (listOne.type) {
            case 'Expression':
                if (listOne.rtx == "rtx") {
                    if (((tdc.data("name") == listOne.mark) && (tdc.data("names") == listOne.name)) && tdc.data("isYhz")) {
                        newTalk = `<div class="dc">
                        <div data-type="${listOne.type}" data-isYhz="true" data-index="${listOne.index}" data-names="${listOne.name}" data-name="${listOne.mark}" class="gu roleOverall rightRoleOverallr">
                          <div class="dfsdfYHZ">
                            <div class="chooseDivYHZ">
                              <input type="checkbox" name="iptChoose" id="" class="iptChooseYHZ ipt">
                            </div>
                          </div>
                          <div class="divImg">
                            <div class="xvb replaceAvatar"></div>
                            <img src="${listOne.base64.indexOf(a) >= 0 ? dataURItoBlob(listOne.base64) : listOne.path}" crossorigin="anonymous" alt="" class="roleImg width0" srcset="">
                          </div>
                          <div class="dfsiohbdu">
                            <div class="Righthorn gfuyfhf qp qpW"></div>
                            <div class="yr">
                              <div class="yt">
                                <div class="yhzName roleNameSpan width0">${listOne.name}</div>
                              </div>
                              <div class="yb">
                                <img src="${listOne.content}" alt="" srcset="" class="rightImgExpression">
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>`;
                    } else {
                        newTalk = `<div class="dc">
                        <div data-type="${listOne.type}" data-isYhz="true" data-index="${listOne.index}" data-names="${listOne.name}" data-name="${listOne.mark}" class="gu roleOverall rightRoleOverall roleOverallTopMargin">
                          <div class="dfsdfYHZ">
                            <div class="chooseDivYHZ">
                              <input type="checkbox" name="iptChoose" id="" class="iptChooseYHZ ipt">
                            </div>
                          </div>
                          <div class="divImg">
                            <div class="xvb"></div>
                            <img src="${listOne.base64.indexOf(a) >= 0 ? dataURItoBlob(listOne.base64) : listOne.path}" crossorigin="anonymous" alt="" class="roleImg" srcset="">
                          </div>
                          <div class="dfsiohbdu">
                            <div class="Righthorn gfuyfhf qp qpW"></div>
                            <div class="yr">
                              <div class="yt">
                                <div class="yhzName roleNameSpan ">${listOne.name}</div>
                              </div>
                              <div class="yb">
                                <img src="${listOne.content}" alt="" srcset="" class="rightImgExpression">
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>`;
                    }
                } else {
                    if (listOne.roleId == 9999) {
                        newTalk = `<div class="dc"><div class="gu roleOverall rightRoleOverall statistics" data-type="${listOne.type}" data-index="${listOne.index}" data-name="${listOne.mark}">
                  <div class="dfsdfYHZ">
                    <div class="chooseDivYHZ">
                      <input type="checkbox" name="iptChoose" id="" class="iptChooseYHZ ipt">
                    </div>
                    <img src="${listOne.content}" alt="" srcset="" class="rightImgExpression udiohsfnds">
                  </div>
                </div></div>`;
                    } else {
                        //表情后面的文字不隐藏头像，所以去掉data-name="${listOne.mark}" 
                        if ((tdc.data("name") == listOne.mark) && (tdc.data("names") == listOne.name)) {
                            newTalk = `<div class="dc">
                            <div class="gu roleOverall" data-type="${listOne.type}" data-names="${listOne.name}" data-index="${listOne.index}">
                              <div class="divImg">
                                <div class="xvb replaceAvatar"></div>
                                <img src="${listOne.base64.indexOf(a) >= 0 ? dataURItoBlob(listOne.base64) : listOne.path}" crossorigin="anonymous" alt="" class="roleImg width0" srcset="">
                              </div>
                              <div class="roleTb"><span class="roleNameSpan width0">${listOne.name}</span>
                                <div class="roleRemarkDivImg"><img src="${listOne.content}" alt="" srcset="" class="rightImgExpression ">
                                <div class="chooseDiv">
                            <input type="checkbox" name="iptChoose" id="" class="iptChoose  ipt">
                          </div></div>
                              </div>
                            </div>
                          </div>`;
                        } else {
                            newTalk = `<div class="dc">
                            <div class="gu roleOverall roleOverallTopMargin" data-type="${listOne.type}" data-name="${listOne.mark}" data-index="${listOne.index}">
                              <div class="divImg">
                                <div class="xvb replaceAvatar"></div>
                                <img src="${listOne.base64.indexOf(a) >= 0 ? dataURItoBlob(listOne.base64) : listOne.path}" crossorigin="anonymous" alt="" class="roleImg" srcset="">
                              </div>
                              <div class="roleTb"><span class="roleNameSpan">${listOne.name}</span>
                                <div class="roleRemarkDivImg"><img src="${listOne.content}" alt="" srcset="" class="rightImgExpression ">
                                <div class="chooseDiv">
                            <input type="checkbox" name="iptChoose" id="" class="iptChoose  ipt">
                          </div></div>
                              </div>
                            </div>
                          </div>`;
                        }
                    }
                }

                html = html + newTalk;
                break;
            case 'img':
                //开启右侧头像
                if (listOne.rtx == "rtx") {
                    console.log(listOne.rtx == "rtx", "是否");
                    if ((tdc.data("name") == listOne.mark) && (tdc.data("names") == listOne.name)) {
                        newTalk = `<div class="dc">
                    <div data-index="${listOne.index}" data-type="${listOne.type}" data-name="${listOne.mark}" class="gu roleOverall rightRoleOverall">
                      <div class="dfsdfYHZ">
                        <div class="chooseDivYHZ">
                          <input type="checkbox" name="iptChoose" id="" class="iptChooseYHZ ipt">
                        </div>
                      </div>
                      <div class="divImg">
                        <div class="xvb replaceAvatar"></div>
                        <img src="${listOne.base64.indexOf(a) >= 0 ? dataURItoBlob(listOne.base64) : listOne.path}" crossorigin="anonymous" alt="" class="roleImg width0" srcset="">
                      </div>
                      <div class="dfsiohbdu">
                        <div class="yr">
                          <div class="yt">
                            <div class="yhzName roleNameSpan marginRight1 width0">${listOne.name}</div>
                          </div>
                          <div class="yb">
                            <!-- <img src="images/Expression/10005.png" alt="" srcset="" class="rightImgExpression"> -->
                            <div class="Righthorn qp qpW"></div>
                            <img src="${dataURItoBlob(listOne.content)}" alt="" srcset="" class="rightImg rightImg1">
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>`

                    } else {
                        newTalk = `<div class="dc">
                        <div data-index="${listOne.index}" data-type="${listOne.type}" data-name="${listOne.mark}"  class="gu roleOverall rightRoleOverall roleOverallTopMargin">
                          <div class="dfsdfYHZ">
                            <div class="chooseDivYHZ">
                              <input type="checkbox" name="iptChoose" id="" class="iptChooseYHZ ipt">
                            </div>
                          </div>
                          <div class="divImg">
                            <div class="xvb"></div>
                            <img src="${listOne.base64.indexOf(a) >= 0 ? dataURItoBlob(listOne.base64) : listOne.path}" crossorigin="anonymous" alt="" class="roleImg" srcset="">
                          </div>
                          <div class="dfsiohbdu">
                            <div class="yr">
                              <div class="yt">
                                <div class="yhzName roleNameSpan marginRight1">${listOne.name}</div>
                              </div>
                              <div class="yb">
                                <div class="Righthorn qp"></div>
                                <img src="${dataURItoBlob(listOne.content)}" alt="" srcset="" class="rightImg rightImg1">
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>`
                    }
                } else {
                    if (listOne.roleId == 9999) {
                        newTalk = `<div class="dc"><div data-index="${listOne.index}"data-type="${listOne.type}" data-name="${listOne.mark}" class="gu roleOverall rightRoleOverall statistics">
                    <div class="dfsdfYHZ">
                      <div class="chooseDivYHZ">
                        <input type="checkbox" name="iptChoose" id="" class="iptChooseYHZ  ipt">
                      </div>
                      <div class="Righthorn qp"></div>
                      <img src="${dataURItoBlob(listOne.content)}" alt="" srcset=""
                        class="rightImg rightImg1">
                    </div>
                  </div></div>`;
                    } else {
                        if ((tdc.data("name") == listOne.mark) && (tdc.data("names") == listOne.name)) {
                            newTalk = `<div class="dc">
                  <div class="gu roleOverall" data-names="${listOne.name}" data-type="${listOne.type}" data-name="${listOne.mark}" data-index="${listOne.index}">
                    <div class="divImg">
                      <div class="xvb replaceAvatar"></div>
                      <img src="${listOne.base64.indexOf(a) >= 0 ? dataURItoBlob(listOne.base64) : listOne.path}" crossorigin="anonymous" alt="" class="roleImg width0" srcset="">
                    </div>
                    <div class="roleTb"><span class="roleNameSpan width0">${listOne.name}</span>
                      <div class="roleRemarkDivImg">
                        <div class="horn qp qpW"></div><img src="${dataURItoBlob(listOne.content)}" alt="" srcset="" class="rightImg rightImg2">
                        <div class="chooseDiv">
                        <input type="checkbox" name="iptChoose" id="" class="iptChoose  ipt">
                      </div>
                      </div>
                    </div>
                  </div>
                </div>`;
                        } else {
                            newTalk = `<div class="dc">
                        <div class="gu roleOverall roleOverallTopMargin" data-names="${listOne.name}" data-type="${listOne.type}" data-name="${listOne.mark}" data-index="${listOne.index}">
                          <div class="divImg">
                            <div class="xvb"></div>
                            <img src="${listOne.base64.indexOf(a) >= 0 ? dataURItoBlob(listOne.base64) : listOne.path}" crossorigin="anonymous" alt="" class="roleImg" srcset="">
                          </div>
                          <div class="roleTb"><span class="roleNameSpan">${listOne.name}</span>
                            <div class="roleRemarkDivImg">
                              <div class="horn qp"></div><img src="${dataURItoBlob(listOne.content)}" alt="" srcset="" class="rightImg rightImg2">
                              <div class="chooseDiv">
                        <input type="checkbox" name="iptChoose" id="" class="iptChoose  ipt">
                      </div>
                            </div>
                          </div>
                        </div>
                      </div>`;
                        }
                    }
                }

                html = html + newTalk;
                break;
            case 'txt':
                //开启右侧头像
                console.log(listOne, 111);
                if (listOne.rtx == "rtx") {
                    console.log(tdc.data("name"), listOne.mark, listOne.name)
                    if ((tdc.data("name") == listOne.mark && tdc.data("names") == listOne.name) && tdc.data("isYhz")) {
                        newTalk = `<div class="dc">
                    <div data-index="${listOne.index}" data-isYhz="true" data-type="${listOne.type}" data-names="${listOne.name}" data-name="${listOne.mark}" class="gu roleOverall rightRoleOverallr">
                      <div class="dfsdfYHZ">
                        <div class="chooseDivYHZ">
                          <input type="checkbox" name="iptChoose" id="" class="iptChooseYHZ ipt">
                        </div>
                      </div>
                      <div class="divImg">
                        <div class="xvb replaceAvatar"></div>
                        <img src="${listOne.base64.indexOf(a) >= 0 ? dataURItoBlob(listOne.base64) : listOne.path}" crossorigin="anonymous" alt="" class="roleImg width0" srcset="">
                      </div>
                      <div class="dfsiohbdu ">
                        <div class="Righthorn gfuyfhf qp qpW"></div>
                        <div class="yr">
                          <div class="yt">
                            <div class="yhzName roleNameSpan width0">${listOne.name}</div>
                          </div>
                          <div class="yb">
                            <div class="roleRemarkDiv3r roleRemarkDiv">
                              <div class="roleRemarkDivSpan statistics" contenteditable="true" data-index="${listOne.index}">${listOne.content}</div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>`;
                    } else {
                        newTalk = `<div class="dc">
                    <div data-index="${listOne.index}" data-isYhz="true" data-type="${listOne.type}" data-names="${listOne.name}" data-name="${listOne.mark}" class="gu roleOverall rightRoleOverall roleOverallTopMargin">
                      <div class="dfsdfYHZ">
                        <div class="chooseDivYHZ">
                          <input type="checkbox" name="iptChoose" id="" class="iptChooseYHZ ipt">
                        </div>
                      </div>
                      <div class="divImg">
                        <div class="xvb"></div>
                        <img src="${listOne.base64.indexOf(a) >= 0 ? dataURItoBlob(listOne.base64) : listOne.path}" crossorigin="anonymous" alt="" class="roleImg" srcset="">
                      </div>
                      <div class="dfsiohbdu">
                        <div class="Righthorn gfuyfhf qp"></div>
                        <div class="yr">
                          <div class="yt">
                            <div class="yhzName roleNameSpan ">${listOne.name}</div>
                          </div>
                          <div class="yb">
                            <div class="roleRemarkDiv3r roleRemarkDiv">
                              <div class="roleRemarkDivSpan statistics" contenteditable="true" data-index="${listOne.index}">${listOne.content}</div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>`;
                    }
                } else {
                    if (listOne.roleId == 9999) {
                        newTalk = `<div class="dc"><div data-index="${listOne.index}" data-type="${listOne.type}" data-name="${listOne.mark}" class="gu roleOverall rightRoleOverall">
                    <div class="dfsdfYHZ width100">
                      <div class="chooseDivYHZ">
                        <input type="checkbox" name="iptChoose" id="" class="iptChooseYHZ  ipt">
                      </div>
                      <div class="Righthorn qp"></div>
                      <div class="roleRemarkDiv3 roleRemarkDiv">
                        <div class="roleRemarkDivSpan statistics" contenteditable="true" data-index="${listOne.index}">${listOne.content}</div>
                      </div>
                    </div>
                  </div></div>`;
                    } else {

                        if ((tdc.data("name") == listOne.mark) && (tdc.data("names") == listOne.name)) {
                            newTalk = `<div class="dc">
                        <div class="gu roleOverall" data-names="${listOne.name}" data-type="${listOne.type}" data-name="${listOne.mark}" data-index="${listOne.index}">
                          <div class="divImg">
                            <div class="xvb replaceAvatar"></div>
                            <img src="${listOne.base64.indexOf(a) >= 0 ? dataURItoBlob(listOne.base64) : listOne.path}" crossorigin="anonymous" alt="" class="roleImg width0" srcset="">
                          </div>
                          <div class="roleTb"><span class="roleNameSpan width0">${listOne.name} </span>
                            <div class="roleRemarkDivs">
                              <div class="horn qp qpW "></div>
                              <div class="roleRemarkDiv2 roleRemarkDiv">
                                <div class="roleRemarkDivSpan statistics" data-index="${listOne.index}" contenteditable="true">${listOne.content}</div>
                              </div>
                              <div class="chooseDiv">
                        <input type="checkbox" name="iptChoose" id="" class="iptChoose  ipt">
                      </div>
                            </div>
                          </div>
                        </div>
                      </div>`;
                        } else {
                            newTalk = `<div class="dc">
                    <div class="gu roleOverall roleOverallTopMargin" data-names="${listOne.name}" data-type="${listOne.type}" data-name="${listOne.mark}" data-index="${listOne.index}">
                      <div class="divImg">
                        <div class="xvb"></div>
                        <img src="${listOne.base64.indexOf(a) >= 0 ? dataURItoBlob(listOne.base64) : listOne.path}" crossorigin="anonymous" alt="" class="roleImg" srcset="">
                      </div>
                      <div class="roleTb"><span class="roleNameSpan">${listOne.name} </span>
                        <div class="roleRemarkDivs">
                          <div class="horn qp"></div>
                          <div class="roleRemarkDiv2 roleRemarkDiv">
                            <div class="roleRemarkDivSpan statistics" data-index="${listOne.index}" contenteditable="true">${listOne.content}</div>
                          </div>
                          <div class="chooseDiv">
                        <input type="checkbox" name="iptChoose" id="" class="iptChoose  ipt">
                      </div>
                        </div>
                      </div>
                    </div>
                  </div>`;
                        }
                    }
                }



                // if (listOne.roleId == 9999) {
                //     if (kqOptions.isYHZ) {
                //         if ((tdc.data("name") == listOne.mark) && (tdc.data("names") == listOne.name)) {
                //             newTalk = `<div class="dc">
                //             <div data-index="${listOne.index}" data-type="${listOne.type}" data-name="${listOne.mark}" class="gu roleOverall rightRoleOverall">
                //               <div class="dfsdfYHZ">
                //                 <div class="chooseDivYHZ">
                //                   <input type="checkbox" name="iptChoose" id="" class="iptChooseYHZ ipt">
                //                 </div>
                //               </div>
                //               <div class="divImg">
                //                 <div class="xvb replaceAvatar"></div>
                //                 <img src="${listOne.base64.indexOf(a) >= 0 ? dataURItoBlob(listOne.base64) : listOne.path}" crossorigin="anonymous" alt="" class="roleImg width0" srcset="">
                //               </div>
                //               <div class="dfsiohbdu">
                //                 <div class="Righthorn gfuyfhf qp qpW"></div>
                //                 <div class="yr">
                //                   <div class="yt">
                //                     <div class="yhzName roleNameSpan width0">${listOne.name}</div>
                //                   </div>
                //                   <div class="yb">
                //                     <div class="roleRemarkDiv3 roleRemarkDiv">
                //                       <div class="roleRemarkDivSpan statistics" contenteditable="true" data-index="${listOne.index}">${listOne.content}</div>
                //                     </div>
                //                   </div>
                //                 </div>
                //               </div>
                //             </div>
                //           </div>`;
                //         } else {
                //             newTalk = `<div class="dc">
                //             <div data-index="${listOne.index}" data-type="${listOne.type}" data-name="${listOne.mark}" class="gu roleOverall rightRoleOverall roleOverallTopMargin">
                //               <div class="dfsdfYHZ">
                //                 <div class="chooseDivYHZ">
                //                   <input type="checkbox" name="iptChoose" id="" class="iptChooseYHZ ipt">
                //                 </div>
                //               </div>
                //               <div class="divImg">
                //                 <div class="xvb"></div>
                //                 <img src="${listOne.base64.indexOf(a) >= 0 ? dataURItoBlob(listOne.base64) : listOne.path}" crossorigin="anonymous" alt="" class="roleImg" srcset="">
                //               </div>
                //               <div class="dfsiohbdu">
                //                 <div class="Righthorn gfuyfhf qp"></div>
                //                 <div class="yr">
                //                   <div class="yt">
                //                     <div class="yhzName roleNameSpan ">${listOne.name}</div>
                //                   </div>
                //                   <div class="yb">
                //                     <div class="roleRemarkDiv3 roleRemarkDiv">
                //                       <div class="roleRemarkDivSpan statistics" contenteditable="true" data-index="${listOne.index}">${listOne.content}</div>
                //                     </div>
                //                   </div>
                //                 </div>
                //               </div>
                //             </div>
                //           </div>`;
                //         }
                //     } else {
                //         newTalk = `<div class="dc"><div data-index="${listOne.index}" data-type="${listOne.type}" data-name="${listOne.mark}" class="gu roleOverall rightRoleOverall">
                //     <div class="dfsdfYHZ">
                //       <div class="chooseDivYHZ">
                //         <input type="checkbox" name="iptChoose" id="" class="iptChooseYHZ  ipt">
                //       </div>
                //       <div class="Righthorn qp"></div>
                //       <div class="roleRemarkDiv3 roleRemarkDiv">
                //         <div class="roleRemarkDivSpan statistics" contenteditable="true" data-index="${listOne.index}">${listOne.content}</div>
                //       </div>
                //     </div>
                //   </div></div>`;
                //     }

                // } else {
                //     if ((tdc.data("name") == listOne.mark) && (tdc.data("names") == listOne.name)) {
                //         newTalk = `<div class="dc">
                //         <div class="gu roleOverall" data-names="${listOne.name}" data-type="${listOne.type}" data-name="${listOne.mark}" data-index="${listOne.index}">
                //           <div class="divImg">
                //             <div class="xvb replaceAvatar"></div>
                //             <img src="${listOne.base64.indexOf(a) >= 0 ? dataURItoBlob(listOne.base64) : listOne.path}" crossorigin="anonymous" alt="" class="roleImg width0" srcset="">
                //           </div>
                //           <div class="roleTb"><span class="roleNameSpan width0">${listOne.name} </span>
                //             <div class="roleRemarkDivs">
                //               <div class="horn qp qpW "></div>
                //               <div class="roleRemarkDiv2 roleRemarkDiv">
                //                 <div class="roleRemarkDivSpan statistics" data-index="${listOne.index}" contenteditable="true">${listOne.content}</div>
                //               </div>
                //               <div class="chooseDiv">
                //         <input type="checkbox" name="iptChoose" id="" class="iptChoose  ipt">
                //       </div>
                //             </div>
                //           </div>
                //         </div>
                //       </div>`;
                //     } else {
                //         newTalk = `<div class="dc">
                //     <div class="gu roleOverall roleOverallTopMargin" data-names="${listOne.name}" data-type="${listOne.type}" data-name="${listOne.mark}" data-index="${listOne.index}">
                //       <div class="divImg">
                //         <div class="xvb"></div>
                //         <img src="${listOne.base64.indexOf(a) >= 0 ? dataURItoBlob(listOne.base64) : listOne.path}" crossorigin="anonymous" alt="" class="roleImg" srcset="">
                //       </div>
                //       <div class="roleTb"><span class="roleNameSpan">${listOne.name} </span>
                //         <div class="roleRemarkDivs">
                //           <div class="horn qp"></div>
                //           <div class="roleRemarkDiv2 roleRemarkDiv">
                //             <div class="roleRemarkDivSpan statistics" data-index="${listOne.index}" contenteditable="true">${listOne.content}</div>
                //           </div>
                //           <div class="chooseDiv">
                //         <input type="checkbox" name="iptChoose" id="" class="iptChoose  ipt">
                //       </div>
                //         </div>
                //       </div>
                //     </div>
                //   </div>`;
                //     }
                // }
                html = html + newTalk;
                break;
            case 'aside':
                newTalk = `<div class="dc">
                <div class="replyDiv">
                  <div class="pangbaiDiv rla gu" data-type="${listOne.type}" data-index="${listOne.index}" data-name="${listOne.mark}"><span class="pangbaiSpan statistics"
                      contenteditable="true" data-index="${listOne.index}">${listOne.content}</span></div>
                  <div class="chooseDivYHZ">
                    <input type="checkbox" name="iptChoose" id="" class="iptChooseYHZ  ipt">
                  </div>
                </div>
              </div>`;
                html = html + newTalk;
                break;
            case 'reply':
                if (tdc.data("type") == listOne.type) {
                    newTalk = "";
                    tdc.append(`<div class='eContentBlue statistics' contenteditable='true' data-index='${listOne.index}' >${listOne.content}</div>`);
                } else {
                    newTalk = `<div class="dc">
                <div class="replyDiv">
                  <div class='eventContainerReply rla gu'  data-index='${listOne.index}' data-type="${listOne.type}" data-name='${listOne.mark}'>
                    <div class="eTopTitle">
                      <div class="colorBlue"></div>
                      <div class="eTitle">回复</div>
                    </div>
                    <div class="eLine"></div>
                    <div class="eContentBlue statistics" contenteditable="true" data-index="${listOne.index}">${listOne.content}</div>
                  </div>
                  <div class="chooseDivYHZ">
                    <input type="checkbox" name="iptChoose" id="" class="iptChooseYHZ  ipt">
                  </div>
                </div>
              </div>`;

                }

                html = html + newTalk;
                break;
            case 'love':
                newTalk = `<div class="dc">
                <div class="replyDiv">
                  <div class='eventContainerLove rla gu' data-type="${listOne.type}" data-index='${listOne.index}' data-name='${listOne.mark}'>
                    <div class="eTopTitle">
                      <div class="colorRed"></div>
                      <div class="eTitle">羁绊事件</div>
                    </div>
                    <div class="eLine"></div>
                    <div class="eContentRed statistics" contenteditable="true" data-index="${listOne.index}">${listOne.content}</div>
                  </div>
                  <div class="chooseDivYHZ">
                    <input type="checkbox" name="iptChoose" id="" class="iptChooseYHZ  ipt">
                  </div>
                </div>
              </div>`;
                html = html + newTalk;
                break;
            case 'Transfer':
                if (listOne.rtx == "rtx") {
                    if ((tdc.data("name") == listOne.mark) && (tdc.data("names") == listOne.name)) {
                        newTalk = ``;
                    } else {
                        newTalk = ``;
                    }
                } else {
                    if (listOne.roleId == 9999) {
                        newTalk = `<div class="dc">
                        <div class="zzDivd MarLeftAuto rightRoleOverall gu ${listOne.Transfer == "djs" ? "" : "opacity05"}" data-type="${listOne.type}" data-index='${listOne.index}' data-name='${listOne.mark}'>
                        <div class="ColorOrangeHornR"></div>  
                        <div class="zzDiv ">
                            <div class="zzDiv_top">
                              <div class="zt_divImg">
                                <img src="images/${listOne.Transfer == "djs" ? "z" : (listOne.Transfer == "gq" ? "g" : (listOne.Transfer == "bjs" ? "d" : "d"))}.png" class="zt_img" alt="" srcset="">
                              </div>
                              <div class="zt_font">
                              <div style="font-size: 1rem;" class="zt-price">￥<span>${listOne.content}</span></div>
                              <div style="font-size: 12px;" class="zt-desc">${listOne.Transfer == "djs" ? "等待确认" : (listOne.Transfer == "gq" ? "已过期" : (listOne.Transfer == "js" ? "已接收" : "已被接收"))}</div>
                              </div>
                              <div class="zt_cz">
                                <div class="zt_gq">过期</div>
                                <div class="zt_js">接收</div>
                                <div class="zt_djs">待接收</div>
                              </div>
                            </div>
                            <div class="zzDiv_bottom">卡丘转账</div>
                          </div>
                          
                        </div>
                      </div>`;
                        html = html + newTalk;
                    } else {
                        newTalk = `<div class="dc">
                            <div class="gu roleOverall roleOverallTopMargin" data-names="${listOne.name}" data-type="${listOne.type}"  data-index="${listOne.index}">
                              <div class="divImg">
                                <div class="xvb"></div>
                                <img src="${listOne.base64.indexOf(a) >= 0 ? dataURItoBlob(listOne.base64) : listOne.path}" crossorigin="anonymous" alt="" class="roleImg" srcset="">
                              </div>
                              <div class="roleTb"><span class="roleNameSpan">${listOne.name} </span>
                                <div class="roleRemarkDivs padNone">
                                <div class="zzDivd ${listOne.Transfer == "djs" ? "" : "opacity05"}">
                            <div class="ColorOrangeHorn qp"></div>
                            <div class="zzDiv">
                              <div class="zzDiv_top">
                                <div class="zt_divImg">
                                  <img src="images/${listOne.Transfer == "djs" ? "z" : (listOne.Transfer == "gq" ? "g" : (listOne.Transfer == "bjs" ? "d" : "d"))}.png" class="zt_img" alt="" srcset="">
                                </div>
                                <div class="zt_font">
                                <div  style="font-size: 1rem;" class="zt-price">￥<span>${listOne.content}</span></div>
                                  <div style="font-size: 12px;" class="zt-desc">${listOne.Transfer == "djs" ? "等待确认" : (listOne.Transfer == "gq" ? "已过期" : "已接收")}</div>
                                </div>
                                <div class="zt_cz">
                                  <div class="zt_gq">过期</div>
                                  <div class="zt_js">接收</div>
                                  <div class="zt_djs">等待确认</div>
                                </div>
      
                              </div>
                              <div class="zzDiv_bottom">卡丘转账</div>
                            </div>
                          </div>
                                  <div class="chooseDiv">
                                <input type="checkbox" name="iptChoose" id="" class="iptChoose  ipt">
                              </div>
                                </div>
                              </div>
                            </div>
                          </div>`;
                        html = html + newTalk;
                    }
                }
                break;
        }
        return html;
    }
    //获取新建角色类型
    function getNewRoleType(id) {
        var json = roleArray;
        var type;
        for (let index = 0; index < json.length; index++) {
            if (id == json[index].id) {
                type = json[index].description;
                break;
            }

        }
        return type;
    }
    //滚动条到最底部
    function ToBtm() {
        $("#box").addClass("height100");
        var scrollHeight = $('#box').prop("scrollHeight") + 9999
        $('#box').scrollTop(scrollHeight);
        console.log("触发", scrollHeight);
    }
    $("#box").on('focusout', '.statistics', function () {
        var ele = $(this);
        updateBoxOne(ele.data('index'), ele.text());
    })
    //旁白
    function aside() {
        $("#text").css("height", "24px");
        var text = $("#text").val();
        if (text != "") {
            var json = new Object();
            json.index = cen;
            json.type = 'aside';
            json.content = text;
            json.mark = 'aside';
            newTalk = createHtml(json)
            insertOrContinue(newTalk, json);
            // textHeightRest ()
        }
    }
    /**
     * 抽出获取发言角色json
     * @param {*} type 类型
     * @returns 
     */
    function getRoleJson(type) {
        var json = new Object();
        var text = $("#text").val();
        var value;
        var base64;
        var avatars = $("img[class*='imgd']");
        if (avatars.length <= 0) {
            value = 9999;
        } else {
            value = chooseAvatar.roleId
            base64 = getBase64(chooseAvatar.roleId);
        }

        json.index = cen;
        json.content = text;
        if (value == 9999) {
            json.roleId = 9999;
            json.mark = '9999';
        } else {
            json.roleId = chooseAvatar.roleId,
                json.imgId = chooseAvatar.imgId,
                json.name = chooseAvatar.name,
                json.content = text,
                json.mark = chooseAvatar.mark;
            if (chooseAvatar.roleId != undefined) {
                json.base64 = '';
                json.path = chooseAvatar.path;
            } else {
                if (getNewRoleType(chooseAvatar.roleId) == "newRole" || getNewRoleType(chooseAvatar.roleId) == null) {
                    json.base64 = base64;
                }
                json.path = chooseAvatar.path
            }
        }
        json.type = type;
        return json
    }

    //特殊事件 回复/羁绊事件
    $('.propIco').click(function () {
        $("#text").css("height", "24px");
        var text = $("#text").val();
        var a = $(this).attr('alt');
        var json = new Object();
        var avatars = $("img[class*='imgd']");

        switch (a) {
            case "转账":
                if (text != "") {
                    json.type = 'Transfer';
                } else {
                    return false
                }
                break;
            case '回复':
                if (text != "") {
                    json.type = 'reply';
                } else {
                    return false
                }
                break;
            case '旁白':
                if (text != "") {
                    json.type = 'aside';
                } else {
                    return false
                }

                break;
            case '羁绊事件':
                json.type = 'love';
                break;

            default:
                return false
                break;
        }
        switch (json.type) {
            case 'Transfer':
                // if (avatars.length > 0) {
                //     json.roleId = chooseAvatar.roleId,
                //         json.imgId = chooseAvatar.imgId,
                //         json.name = chooseAvatar.name,
                //         json.content = text,
                //         json.mark = chooseAvatar.mark;
                //     if (chooseAvatar.roleId != undefined) {
                //         json.base64 = '';
                //         json.path = chooseAvatar.path;
                //     } else {
                //         if (getNewRoleType(chooseAvatar.roleId) == "newRole" || getNewRoleType(chooseAvatar.roleId) == null) {
                //             json.base64 = base64;
                //         }
                //         json.path = chooseAvatar.path
                //     }
                // } else {
                //     json.roleId = '9999';
                //     json.mark = '9999';
                //     json.content = text;
                json = getRoleJson(json.type);
                json.Transfer = "djs";
                break;
            case 'love':
                if (avatars.length > 0) {
                    json.content = '前往' + chooseAvatar.name + "的羁绊剧情";
                    json.name = chooseAvatar.name;
                    json.mark = chooseAvatar.mark;
                } else {
                    json.mark = '9999';
                    json.content = '前往引航者的羁绊剧情';
                }
                json.roleId = chooseAvatar.roleId;
                break;
            case 'reply':
            case 'aside':
                json.content = text;
                break;
            default:
                break;
        }
        json.index = cen;
        var newTalk = createHtml(json)
        insertOrContinue(newTalk, json);
    })


    //base64转blob
    function dataURItoBlob(base64Data) {
        var byteString;
        if (base64Data.split(',')[0].indexOf('base64') >= 0)
            byteString = atob(base64Data.split(',')[1]);//base64 解码
        else {
            byteString = unescape(base64Data.split(',')[1]);
        }
        var mimeString = base64Data.split(',')[0].split(':')[1].split(';')[0];//mime类型 -- image/png

        // var arrayBuffer = new ArrayBuffer(byteString.length); //创建缓冲数组
        // var ia = new Uint8Array(arrayBuffer);//创建视图
        var ia = new Uint8Array(byteString.length);//创建视图
        for (var i = 0; i < byteString.length; i++) {
            ia[i] = byteString.charCodeAt(i);
        }
        var blob = new Blob([ia], {
            type: mimeString
        });
        var url = URL.createObjectURL(blob);
        return url;
    }
    //加载未删除数据
    function loadBoxData() {

        getTempJson().then(res => {
            $('#box').html("");
            boxJsonArray = res.boxJson;
            var temp = boxJsonArray[0].index;
            var a = 'data:image'
            var num = 9999;
            for (let i = 0; i < boxJsonArray.length; i++) {
                if (boxJsonArray[i].index > temp) {
                    temp = boxJsonArray[i].index;
                }
                var newTalk = createHtml(boxJsonArray[i]);
                $('#box').append(newTalk);
            }
            cen = boxJsonArray.length > 0 ? temp + 1 : 0
            ToBtm();
        })

    }

    //重置角色名称
    $("#ReName").click(function () {
        var a = confirm("确定要重置全部角色名称吗？");
        if (a) {
            deleteRoleCopy().then(res => {
                window.location.reload();
            })

        }
    });
    /**
     * 将localstrong中的存档转入indexdb，临时使用，下个版本废弃
     */
    function localUpdateIndexDb() {
        var json = JSON.parse(localStorage.getItem("boxJson"));
        if (json != "" && json != null) {
            LocalMigrate(json).then(res => {
                localStorage.clear();
            })
        }

    }
    //跳转到新网址
    function toNewPath() {
        var url = window.location.href;
        //console.log(url);
        if (url.indexOf("gugutack.com") == -1) {
            if (confirm("是否跳转新站点，当前数据无法保存")) {
                window.location.replace("http://gugutack.com/index.html")
            }

        }
    }

    //初始化数据
    function Init() {
        // toNewPath();
        $("#knopiji").html('');
        $.getJSON("data/roles.json", function (data) {
            $.getJSON("data/imagese.json", function (dataImg) {
                data.forEach(item => {
                    item.imgURl = 'images/roleImages/' + item.imgURl + '.png';
                    item.belongsImgURL = 'images/roleImages/' + item.belongsImgURL + '.webp';
                    item.open = false;
                    item.avatarArray = '';
                });
                createRoleArrayCopy(data).then(res => {
                    roleArray = res;
                    //循环展示角色
                    var html = '';
                    var b = '';
                    var Aa = `<div class='centerRoleArraybtn n'>`;
                    var aa = `</div>`;
                    for (let index = 0; index < roleArray.length; index++) {
                        $(".center").append("<div class='sonbsc'><div class='xq' data-id='" + roleArray[index].id + "'><div class='wwww'><img crossOrigin='anonymous' src='" + roleArray[index].imgURl + "' alt='' height=75px; width=75px; class='sdad'><span class='roleName'>" + roleArray[index].roleName + "</span><a href='javascript:;' class='adb'><img src='images/updateName.png' class='updateName' alt='' srcset=''></a></div><img src='" + roleArray[index].belongsImgURL + "' class='ddddddddddd' alt='' srcset=''></div></div>")
                        var roleImgs = new Array();
                        var b = "";
                        if (roleArray[index].description == "newRole") {
                            var obj = {
                                choose: false,
                                id: roleArray[index].id,
                                imagePath: roleArray[index].imgURl,
                                imgName: roleArray[index].roleName,
                                mark: roleArray[index].roleName,
                                path: roleArray[index].imgURl,

                            }
                            roleImgs.push(obj)
                            b += `<img data-mark="${obj.mark}" class='conImg imgb' data-imgid='${obj.id}'  data-roleId='${obj.roleId}' data-open='${obj.choose}' title='${obj.imgName}' src=' ${obj.path}' crossOrigin='anonymous' alt='' srcset=''>`
                        } else {
                            dataImg.forEach(item => {
                                if (item.roleId == roleArray[index].id) {
                                    item.mark = item.imagePath;
                                    item.path = 'images/roleImages/' + item.imagePath + '.png';
                                    item.choose = false;
                                    roleImgs.push(item);
                                    b += `<img data-mark="${item.mark}" class='conImg imgb' data-imgid='${item.id}'  data-roleId='${item.roleId}' data-open='${item.choose}' title='${item.imgName}' src=' ${item.path}' crossOrigin='anonymous' alt='' srcset=''>`

                                }
                            });
                        }
                        html += `<div class='sonbsc'><div class='xq' data-id='${roleArray[index].id}'><div class='wwww'><img crossOrigin='anonymous' src='${roleArray[index].imgURl}' alt='' height=75px; width=75px; class='sdad'><span class='roleName'>${roleArray[index].roleName}</span><a href='javascript:;' class='adb'><img src='images/updateName.png' class='updateName' alt='' srcset=''></a></div><img src='${roleArray[index].belongsImgURL}' class='ddddddddddd' alt='' srcset=''></div>${Aa}${b}${aa}</div>`;
                        roleArray[index].avatarArray = roleImgs;
                    }
                    //console.log(roleArray);
                    $("#knopiji").html(html);
                    LoadAvatar().then(res => {
                        if (res != undefined) {
                            roleImgArray = res;
                            var conImg = $(".conImg");
                            for (let index = 0; index < roleImgArray.length; index++) {
                                for (let i = 0; i < conImg.length; i++) {
                                    if ($(conImg[i]).data("imgid") == roleImgArray[index].imgId) {
                                        console.log($(conImg[i]));
                                        $(conImg[i]).toggleClass("imgb bj");
                                        $(conImg[i]).parent().siblings(".xq").addClass("qx");
                                        break;
                                    }
                                }
                            }
                            btnAvatars();
                        }

                    })
                    LoadSetOptions();
                })
            });
        }
        );
        ExpressionInit(1);
        getTempJson().then(res => {
            if (res != null && res != '') {
                loadBoxData();
            }
        });
    }
    //点击选取头像加入到下方准备
    $("#knopiji").on('click', '.conImg', function (e) {
        $(this).toggleClass("imgb bj");
        if ($(this).parent().children().is(".bj")) {
            $(this).parent().siblings(".xq").addClass("qx");
        } else {
            $(this).parent().siblings(".xq").removeClass("qx");
        }
        roleAvatarClick($(this));
        e.stopPropagation();
    })
    //删除自定义角色事件
    $("#knopiji").on('click', '.ddddddddddd', function (e) {
        var id = $(this).parents().filter(".xq").data("id");
        for (let index = 0; index < roleArray.length; index++) {
            if (roleArray[index].description == 'newRole' && roleArray[index].id == id) {
                deleteRole(roleArray[index].id, e);
                break;
            }
        }

    })
    //点击展开角色头像
    $("#knopiji").on('click', '.xq', function (e) {
        var dom = $(this).next();
        var id = $(this).data("id");
        roleArray.forEach(item => {
            if (item.id == id) {
                if (item.open) {
                    item.open = false
                    dom.css("display", "none");
                } else {
                    item.open = true
                    dom.css("display", "flex");
                }
            }
        });
    })
    /**
     * 修改对话
     */
    $("#knopiji").on('click', '.updateName', function (e) {
        updateName(this, e);
        e.stopPropagation();
    })
    //重置选中角色头像
    function ReCheckAvatar() {
        var avatars = $("img[class*='imgd']");
        for (let index = 0; index < avatars.length; index++) {
            $(avatars[index]).attr('class', 'conAvataar zz');
        }
    }
    //修改角色名字
    function updateName(d, e) {
        var newName = prompt('请输入新名称');
        if (newName !== null && newName != ' ') {
            var id = $(d).parent().parent().parent().data("id");
            var copyList = roleArray;
            for (let index = 0; index < copyList.length; index++) {
                if (copyList[index].id == id) {
                    copyList[index].roleName = newName;
                    updateRoleName(id, newName).then(res => {
                        $(d).parent().siblings("span").html(newName)
                    })
                    ReCheckAvatar();
                    break;
                }
            }
        }
    }
    //初始化表情包
    function ExpressionInit(num) {
        $('.imgContent').html("");
        var st = "";
        var a = "";
        var ele = $(".yhivdfbs");
        if (num == 1) {
            st = "data/Expression.json";
            a = "images/Expression/";
        } else {
            st = "data/roleExpression.json";
            a = "images/roleExpression/";
        }
        $.getJSON(st,
            function (data) {
                data.forEach(element => {
                    element.expressionName = a + element.expressionName + '.png';
                });
                for (let i = 0; i < data.length; i++) {
                    $('.imgContent').append("<img src='" + data[i].expressionName + "' alt='' srcset='' class='hgfhdft'>");
                    $('.imgContent').children().eq(i).click(function () {
                        ExpressionSend($(this));
                    });
                }
            }
        )
    }
    //表情包点击发送
    function ExpressionSend(e) {
        var imgObj = e.attr('src');
        var newTalk = '';
        // var avatars = $("img[class*='imgd']");
        // if (avatars.length <= 0) {
        //     value = 9999;
        // } else {
        //     value = chooseAvatar.roleId
        // }
        // if (value == 9999) {
        //     json.roleId = 9999;
        //     json.content = imgObj;
        //     json.mark = '9999';
        //     newTalk = createHtml(json)
        //     insertOrContinue(newTalk, json);
        // } else {
        //     json.roleId = chooseAvatar.roleId,
        //         json.imgId = chooseAvatar.imgId,
        //         json.path = chooseAvatar.path,
        //         json.name = chooseAvatar.name,
        //         json.content = imgObj;
        //     json.mark = chooseAvatar.mark;
        //     json.base64 = chooseAvatar.roleId == "undefined" ? chooseAvatar.path : getBase64(chooseAvatar.roleId);
        //     newTalk = createHtml(json)
        //     insertOrContinue(newTalk, json);
        // }
        var json = getRoleJson("Expression");
        json.content = imgObj;
        newTalk = createHtml(json)
        insertOrContinue(newTalk, json);

        closeExpression()
    }
    //角色头像点击事件
    function roleAvatarClick(e) {
        $("#js").removeClass("border2sy");
        roleImgArray = new Array();
        var avatars = $("img[class*='bj']");
        console.log(avatars);
        for (var i = 0; i < avatars.length; i++) {
            var newObj = {
                roleId: $(avatars[i]).data("roleid"),
                imgId: $(avatars[i]).data("imgid"),
                imgPath: $(avatars[i]).attr("src"),
                mark: $(avatars[i]).data("mark")
            }
            roleImgArray.push(newObj);
        }
        updateAvatar(roleImgArray);
        btnAvatars();
    }
    //生成底部备选头像列表
    function btnAvatars() {
        $(".bottomImgs").html("");
        var txt = '';
        roleImgArray.forEach(item => {
            txt = txt + "<img data-name=" + item.mark + " class='conAvataar zz' data-roleid='" + item.roleId + "' data-imgId='" + item.imgId + "' src='" + item.imgPath + "' srcset=''>";
        });
        $(".bottomImgs").html(txt);
    }


    //点击选取底部备选头像
    $(".bottom1").on("click", ".conAvataar", function () {
        if ($("#js").is(".border2sy")) {
            var imgid = $(this).data("imgid");
            var temp = new Array();
            roleImgArray.forEach(item => {
                if (imgid != item.imgId) {
                    temp.push(item);
                }
            })
            roleImgArray = temp;
            updateAvatar(roleImgArray);
            $(this).remove();
            if (roleImgArray == "") {
                $("#js").removeClass("border2sy");
            }
            $(".conImg").each(function () {
                if ($(this).data("imgid") == imgid) {
                    $(this).toggleClass("imgb bj");
                    if (!$(this).siblings().is(".bj")) {
                        $(this).parent().siblings(".xq").removeClass("qx");
                    }
                }

            })
            return;
        }
        $(this).toggleClass("zz");
        $(this).siblings().addClass("zz");
        if ($(this).hasClass("imgd")) {
            $(this).removeClass("imgd");
        }
        else {
            $(".conAvataar").each(function () {
                $(this).removeClass("imgd");
            })
            $(this).addClass("imgd");
            var obj = {
                roleId: $(this).data("roleid"),
                imgId: $(this).data("imgid"),
                path: $(this).attr("src"),
            }
            var roleName = '';
            var list = roleArray;
            for (let i = 0; i < list.length; i++) {
                if ((obj.roleId == "undefined" && obj.imgId == list[i].id) || list[i].id == obj.roleId) {
                    roleName = list[i].roleName;
                }
            }
            obj.mark = $(this).data('name');
            obj.name = roleName;
            chooseAvatar = obj;
        }
    })
    /**
     * 通过id获取base64头像
     * @param {*} id 
     * @returns 
     */
    function getBase64(id) {
        var base64;
        json = roleArray;
        for (let index = 0; index < json.length; index++) {
            if (json[index].id == id) {
                base64 = json[index].imgURl;
                break;
            }

        }
        return base64;
    }
    //切分文本长度
    function getActualWidthOfChars(text, options = {}) {
        const { size = 18, family = "none" } = options;
        const canvas = document.createElement("canvas");
        const ctx = canvas.getContext("2d");
        ctx.font = `${size}px ${family}`;
        const metrics = ctx.measureText(text);
        const actual = Math.abs(metrics.actualBoundingBoxLeft) + Math.abs(metrics.actualBoundingBoxRight);
        return Math.max(metrics.width, actual);
    }
    //删除当前gugutalk
    $('#delAll').click(function () {
        var a = $("div[class*='dc']");
        var b = $(":checked[type='checkbox']").parents(".dc");
        //console.log(b);
        if (b.length > 0) {
            if (confirm("确认要删除" + b.length + "条数据吗")) {
                b.each(function () {
                    for (let index = 0; index < boxJsonArray.length; index++) {
                        if ($(this).find(".gu").data("index") == boxJsonArray[index].index) {
                            var i = index;
                            console.log($(this).find(".gu").data("index"));
                            if (boxJsonArray[index].type == "reply") {
                                while (boxJsonArray[i].type == "reply") {
                                    i++;
                                }
                                boxJsonArray.splice(index, i - index - 1);
                            }
                            boxJsonArray.splice(index, 1);
                            break;
                        }
                    }
                })
                updateTempJson(boxJsonArray).then(res => {
                    loadBoxData();
                });

            }
        } else {
            if (a.length > 0) {
                var c = confirm("确认要全部删除吗？");
                if (c) {
                    $("#box").html('');
                    cen = 0
                    boxJsonArray = new Array()
                    deleteTempJson();
                }
            }
        }
    })
    //删除上一句
    $("#delOne").click(function () {
        var editOpen = $(".editOpen");
        var lastDc = $("#box").children().last();
        if (editOpen.length > 0) {
            for (let i = 0; i < boxJsonArray.length - 1; i++) {
                if (editOpen.prev().find(".gu").data("index") == boxJsonArray[i].index) {
                    boxJsonArray.splice(i, 1);
                    break
                }
            }
            editOpen.prev().remove();

        } else {
            boxJsonArray.splice(boxJsonArray.length - 1, 1);
            lastDc.remove();
        }
        updateTempJson(boxJsonArray);
    });
    //发送图片
    $("#imgUpload").click(function () {
        // var avatars = $("img[class*='imgd']");
        // var json = new Object();
        // if (avatars.length <= 0) {
        //     value = 9999;
        // } else {
        //     value = chooseAvatar.roleId
        // }
        var link = document.createElement("input");
        var jq = $(link);
        jq.attr({ "type": "file", "accept": "image/*" });
        jq.on("change", function () {

            var imgP = $(this);
            var imgObj = imgP[0].files[0];
            var newImg;
            //压缩图片
            compressImg(imgObj, 0.2).then(res => {
                newImg = res.afterSrc;
                var url = newImg;
                // if (value == 9999) {
                //     json.roleId = 9999;
                //     json.mark = '9999';
                //     json.content = url;
                //     newTalk = createHtml(json)
                //     insertOrContinue(newTalk, json);
                // } else {
                //     json.roleId = chooseAvatar.roleId;
                //     json.imgId = chooseAvatar.imgId;
                //     json.path = chooseAvatar.path;
                //     json.name = chooseAvatar.name;
                //     json.mark = chooseAvatar.mark;
                //     json.base64 = chooseAvatar.roleId == "undefined" ? chooseAvatar.path : getBase64(chooseAvatar.roleId);
                //     json.content = url;
                // }
                var json = getRoleJson("img");
                json.content = url;
                var newTalk = createHtml(json)
                insertOrContinue(newTalk, json);
            })
        })
        jq.click();
    })
    //打开设置列表
    $("#setList").click(function () {
        $("#knopiji").html("");
        loadSetList().then(res => {
            console.log("res", res);
            if (res != undefined) {
                var html = `<div class="setList">
              <div>字体大小<input type="text" id="guFont-size" value="${res.guFont_size}" placeholder="数字，默认1.2">rem</div>
              <div>背景颜色<input type="text" name="" id="guBackColor" value="${res.guBackColor}" placeholder="white、#ffffff、rgb(0,0,0)"><div style="display:inline;" class="whDiv whDiv2 layui-icon layui-icon-tips-fill"></div></div>
              <div>旁白字体大小<input type="text" name="" id="guAsideFont-size" value="${res.guAsideFont_size}" placeholder="数字，默认1.1">rem</div>
              <div>下载图片清晰度<input type="text" name="" id="loadImg-scale" value="${res.loadImg_scale}" placeholder="1-4，不要乱填！"></div>
              <div><button type="button" id="setSave">保存</button></div>
              <div><button type="button" id="setRe">重置</button></div>
            </div>`;
                $("#knopiji").append(html);
            }
        })

    })
    $("#knopiji").on("click", ".whDiv2", function () {
        alert("支持颜色格式如下,例：\n英文单词：white\n16进制：#FFFFFF\nrgb格式：rgb(207,207,206)");
    })
    //保存设置参数
    $("#knopiji").on("click", "#setSave", function () {
        var guFont_size = $("#guFont-size").val();
        var guBackColor = $("#guBackColor").val()
        var guAsideFont_size = $("#guAsideFont-size").val();
        var loadImg_scale = $("#loadImg-scale").val();
        var options = {
            guFont_size: guFont_size,
            guBackColor: guBackColor,
            guAsideFont_size: guAsideFont_size,
            loadImg_scale: loadImg_scale
        }
        setOption(options);
        updateSetList(options);
    })
    /**
     * 启用修改后的设置
     * @param {*} options 
     */
    function updateSetList(options) {
        //对话样式
        $(".roleRemarkDivSpan").css({
            "font-size": options.guFont_size + "rem",
        })
        //背景颜色
        $(".right").css({
            "background-color": options.guBackColor,
        })
        $("#box").css({
            "background-color": options.guBackColor,
        })
        //旁白字体大小
        $(".pangbaiSpan").css({
            "font-size": options.guAsideFont_size + "rem",
        })
        //下载图片清晰度
        imgScale = options.loadImg_scale;
    }
    //重置设置列表
    $("#knopiji").on("click", "#setRe", function () {
        var options = {
            guFont_size: "1.2",
            guBackColor: "rgb(207,207,206)",
            guAsideFont_size: "1.1",
            loadImg_scale: "1"
        }
        setOption(options);
        $("#guFont-size").val(options.guFont_size)
        $("#guBackColor").val(options.guBackColor)
        $("#guAsideFont-size").val(options.guAsideFont_size);
        $("#loadImg-scale").val(options.loadImg_scale);
        updateSetList(options);
    })
    /**
     * 截图保存
     */
    $("#save").click(function () {
        var b = $(":checked[type='checkbox']").parents(".dc");
        if (b.length > 0) {
            if (confirm("是否只保存选中信息")) {
                $("#box>.dc input[type='checkbox']:not(:checked)").each(function () {
                    $(this).parents().filter(".dc").addClass("disNoneD");
                });
            }
        }

        $("#box").removeClass("height100");
        var scrollHeight = $('#box').prop("scrollHeight");
        var scrollWidth = $('#box').prop("scrollWidth");
        $(".iptChoose").addClass("chooseNone");
        $(".iptChooseYHZ").addClass("chooseNone");
        $("[type='checkbox']").prop("checked", false);
        $(".zt_cz").addClass("disNoneD")
        $(".dc").removeClass("editOpen");//document.getElementById('box')
        //页面等待动画
        $("#app").addClass("opacity05");
        $(".donut").removeClass("disNoneD");
        $(".donut").css("opacity", "1")
        domtoimage.toJpeg($("#box")[0], { scale: imgScale, height: scrollHeight, width: scrollWidth })
            .then(function (dataUrl) {
                var link = document.createElement('a');
                link.download = 'gugutalk.png';
                link.href = dataUrl;
                link.click();
                $(".iptChoose").removeClass("chooseNone");
                $(".iptChooseYHZ").removeClass("chooseNone");
                $(".zt_cz").removeClass("disNoneD")
                $("#app").removeClass("opacity05");
                $(".donut").addClass("disNoneD");
                loadBoxData();
                ToBtm();
            });
    })
    /**
     * 检测是否已展开存档列表，展开则刷新
     */
    function reLoadLeftArchive() {
        if ($(".sonbsc").length <= 0) {
            LoadArchive($("#knopiji"), 2)
        }
    }
    //创建新系列
    $(".newArchive").click(function () {
        Archive().then(res => {
            LoadArchive($(".oldArchive"), 1)
            reLoadLeftArchive();
        })
    })
    //点击存档按钮打开存档页面
    $("#ArchiveSave").click(function () {
        LoadArchive($(".oldArchive"), 1);
        $(".archiveList").toggleClass("n");
    })
    //点击展开角色列表
    $("#RoleList").click(function () {
        Init();
    })
    //点击展开一级存档列表
    $("#ArchiveList").click(function () {
        LoadArchive($("#knopiji"), 2)
    })
    //点击展开二级存档
    $("#knopiji").on('click', '.AL-ArchiveOne', function (e) {
        $(this).parents().filter(".AL-Series").find(".AL-OneChildList").toggleClass("n");
        e.stopPropagation();
    })
    //点击读取存档
    $("#knopiji").on('click', '.dxx', function (e) {
        var id = $(this).find(".AL-imgTools").data("id");
        var cid = $(this).find(".AL-imgTools").data("cid");
        var title = $(this).find(".word-wrap").html();
        //console.log(id,cid,title);
        if (confirm("是否读取" + title)) {
            updateArchive(id, cid).then(res => {
                loadBoxData();
            })
        }

        e.stopPropagation();
    })
    //点击关闭存档
    $(".archiveGb").click(function () {
        $(this).parents().filter(".archiveList").toggleClass("n");
    })
    //点击修改标题
    $("#knopiji").on('click', '.AL-updateTitle', function (e) {
        var title = $(this).parents().filter(".AL-TitleDiv").find(".AL-Title").html();
        var id = $(this).parent().data("id");
        var cid = $(this).parent().data("cid");
        var newTitle = prompt("修改标题《" + title + "》为");
        if (newTitle != null && newTitle != "") {
            if (id == cid)
                updateTitle(id, newTitle).then(res => {
                    $(this).parents().filter(".AL-TitleDiv").find(".AL-Title").html(newTitle);
                })
            else
                updateTitle(id, newTitle, cid).then(res => {
                    $(this).parents().filter(".AL-TitleDiv").find(".AL-Title").html(newTitle);
                });
        }
        e.stopPropagation();
    })
    //删除存档
    $("#knopiji").on('click', '.AL-deleteArchive', function (e) {
        var id = $(this).parent().data("id");
        var cid = $(this).parent().data("cid");
        var title = $(this).parents().filter(".AL-TitleDiv").find(".AL-Title").html();
        if (id == cid) {
            if (confirm("是否删除《" + title + "》系列")) {
                deleteBoxArrayById(id).then(res => {
                    LoadArchive($("#knopiji"), 2);
                })
            }
        } else {
            if (confirm("是否删除《" + title + "》该存档")) {
                deleteBoxArrayChild(id, cid).then(res => {
                    LoadArchive($("#knopiji"), 2);
                })
            }
        }
        e.stopPropagation();
    })
    //存档页面点击系列展开存档
    $(".oldArchive").on('click', '.AL-ArchiveOne', function () {
        $(this).siblings().filter(".AL-OneChildList").toggleClass("n");
    })
    //存档页面根据id插入存档
    $(".oldArchive").on('click', '.AL-insertSeries', function (e) {
        var id = $(this).parent().data("id");
        var title = $(this).parents().filter(".AL-TitleDiv").find(".AL-Title").html();
        if ($(".dc").length > 0) {
            if (confirm("是否将当前gugutalk插入《" + title + "》系列")) {
                var newtitle = prompt("请输入标题,为空则生成默认标题");
                insertArchive(id, newtitle).then(res => {
                    $(this).parents().filter(".AL-Series").find(".AL-OneChildList").append(`<div class="AL-TitleDiv">
                <div class="AL-Title word-wrap mhhh">${res.ctitle}</div>
                <div class="AL-imgTools" data-id="${res.id}" data-cid="${res.cid}">
                <img src="/images/replace.png" alt="" srcset="" class="AL-replaceArchive">
                </div>
              </div>`)
                    reLoadLeftArchive()
                });

            }
        }
        e.stopPropagation();
    })
    //存档页面替换存档按钮
    $(".oldArchive").on('click', '.AL-replaceArchive', function () {
        var id = $(this).parent().data("id");
        var cid = $(this).parent().data("cid");
        var title = $(this).parents().filter(".AL-TitleDiv").find(".AL-Title").html();
        if (confirm("是否使用当前gugutalk替换《" + title + "》存档")) {
            var newtitle = prompt("是否修改标题，为空则不修改");
            if (newtitle != null) {
                replaceArchive(id, cid, newtitle).then(res => {
                    reLoadLeftArchive()
                    $(this).parents().filter(".AL-TitleDiv").find(".mhhh").html(newtitle)
                });

            }

        }
    })
    /**
     * 加载存档
     * @param {*} obj jquery对象
     * @param {*} type 1:存档 2:展开存档列表
     */
    function LoadArchive(obj, type) {
        getBoxArray().then(res => {
            console.log(res, "长度");

            obj.html("");
            var html = "";
            switch (type) {
                case 1:
                    var a = "";
                    var tempB = `<div class="AL-OneChildList n">`
                    var tempA = `</div>`;
                    $.each(res, function (i, m) {
                        var b = "";
                        $.each(m.boxJsonArrays, function (t, n) {
                            b += `<div class="AL-TitleDiv">
                            <div class="AL-Title word-wrap mhhh">${n.ctitle}</div>
                            <div class="AL-imgTools" data-id="${m.id}" data-cid="${n.cid}">
                            <img src="/images/replace.png" alt="" srcset="" class="AL-replaceArchive">
                            </div>
                          </div>`;
                        })
                        var c = `<div class="AL-ArchiveOne">
                        <div class="AL-TitleDiv">
                          <div class="AL-Title mhh">${m.title}</div>
                          <div class="AL-imgTools" data-id="${m.id}" data-cid="${m.id}">
                          <img src="/images/insert.png" alt="" srcset="" class="AL-insertSeries">
                          </div>
                        </div>
                      </div>`
                        a += `<div class="AL-Series">` + c + tempB + b + tempA + `</div>`;
                    })
                    obj.html(a);
                    return;
                    break;
                case 2:
                    if (res == undefined) {
                        alert("当前没有存档");
                    } else {
                        if (res.length == 0) {
                            alert("当前没有存档");
                        }
                    }
                    var a = "";
                    var tempB = `<div class="AL-OneChildList n">`
                    var tempA = `</div>`;
                    $.each(res, function (i, m) {
                        var b = "";
                        $.each(m.boxJsonArrays, function (t, n) {
                            b += `<div class="AL-TitleDiv dxx">
                            <div class="AL-Title word-wrap">${n.ctitle}</div>
                            <div class="AL-imgTools" data-id="${m.id}" data-cid="${n.cid}">
                              <img src="/images/updateName.png" alt="" srcset="" class="AL-updateTitle">
                              <img src="/images/gb.png" alt="" srcset="" class="AL-deleteArchive">
                            </div>
                          </div>`;
                        })
                        var c = `<div class="AL-ArchiveOne">
                        <div class="AL-TitleDiv">
                          <div class="AL-Title">${m.title}</div>
                          <div class="AL-imgTools" data-id="${m.id}" data-cid="${m.id}">
                            <img src="/images/updateName.png" alt="" srcset="" class="AL-updateTitle">
                            <img src="/images/gb.png" alt="" srcset="" class="AL-deleteArchive">
                          </div>
                        </div>
                      </div>`
                        a += `<div class="AL-Series">` + c + tempB + b + tempA + `</div>`;
                    })
                    obj.append(a);
                    return;
                    break;
                default:
                    break;
            }


        })
    }
    //图片压缩
    /**
 * 压缩方法 
 * @param {string} file 文件
 * @param {Number} quality  0~1之间
*/
    function compressImg(file, quality) {
        if (file[0]) {
            return Promise.all(Array.from(file).map(e => compressImg(e,
                quality))) // 如果是 file 数组返回 Promise 数组
        } else {
            return new Promise((resolve) => {
                const reader = new FileReader() // 创建 FileReader
                reader.onload = ({
                    target: {
                        result: src
                    }
                }) => {
                    const image = new Image() // 创建 img 元素
                    image.onload = async () => {
                        const canvas = document.createElement('canvas') // 创建 canvas 元素
                        canvas.width = image.width
                        canvas.height = image.height
                        canvas.getContext('2d').drawImage(image, 0, 0, image.width, image.height) // 绘制 canvas
                        const canvasURL = canvas.toDataURL('image/jpeg', quality)
                        const buffer = atob(canvasURL.split(',')[1])
                        let length = buffer.length
                        const bufferArray = new Uint8Array(new ArrayBuffer(length))
                        while (length--) {
                            bufferArray[length] = buffer.charCodeAt(length)
                        }
                        const miniFile = new File([bufferArray], file.name, {
                            type: 'image/jpeg'
                        })
                        resolve({
                            file: miniFile,
                            origin: file,
                            beforeSrc: src,
                            afterSrc: canvasURL,
                            beforeKB: Number((file.size / 1024).toFixed(2)),
                            afterKB: Number((miniFile.size / 1024).toFixed(2))
                        })
                    }
                    image.src = src
                }
                reader.readAsDataURL(file)
            })
        }
    }

    //全选
    $("#selectAll").click(function () {
        selectAllOrReSelectAll(1);
    })
    //反选
    $("#reSelectAll").click(function () {
        selectAllOrReSelectAll(2);
    })
    /**
     * 选择方式
     * @param {*} type 1:全选 2反选
     */
    function selectAllOrReSelectAll(type) {
        var selectBox = $(":checked[type='checkbox']");
        var allBox = $("[type='checkbox']");
        var noSelectBox = $("[type='checkbox']:not(:checked)")
        switch (type) {
            case 1:
                if (selectBox.length == allBox.length) {
                    selectBox.prop("checked", false)
                    $(".dc").removeClass("editOpen");

                } else {
                    allBox.prop("checked", true)
                    $("#box>.dc:first").addClass("editOpen").siblings().removeClass("editOpen");
                }

                break;
            case 2:
                allBox.each(function () {
                    $(this).click();
                })
                break;
            default:
                break;
        }
    }
    //创建角色
    $("#newRole").click(function () {
        var roleName = prompt("请输入角色姓名", "");
        if (roleName != null && roleName != '') {
            var link = document.createElement("input");
            var jq = $(link);
            jq.attr({ "type": "file", "accept": "image/*" });
            jq.on("change", function () {
                var json = new Object();
                var imgP = $(this);
                var imgObj = imgP[0].files[0];
                compressImg(imgObj, 0.2).then(res => {//compressImg方法见附录
                    var url = res.afterSrc;
                    json.id = parseInt(getNowTime());
                    json.roleName = roleName;
                    json.description = "newRole";
                    json.imgURl = url;
                    newRoleSave(json);

                })
            })
        }
        jq.click();
    })
    //保存新建角色
    function newRoleSave(ele) {
        ele.belongsImgURL = 'images/gb.png';
        roleArray.unshift(ele);
        console.log(roleArray, ele);
        createNewRoleArray(ele).then(res => {
            Init();
        });

        //window.location.reload();
    }
    //删除自定义角色
    function deleteRole(id, e) {
        var c = confirm("确认要删除吗？");
        if (c) {
            deleteNewRoleById(id);
            window.location.reload();
        }

        e.stopPropagation();
    }
    //下一个表情包
    $(".ToT").click(function () {
        ExpressionInit(1);
    })
    //上一个表情包
    $(".ToB").click(function () {
        ExpressionInit(2);
    })
    //打开表情包
    $("#imgExpression").click(function () {
        $('.Gallery').toggleClass('n');
    })
    //打开/关闭设置列表
    $("#updateSet").click(function () {
        $('.Gallery').toggleClass('n');
    })
    $('.gb').click(function () {
        closeExpression();
    })
    //关闭表情包
    function closeExpression() {
        $(".Gallery").addClass('n');
    }
    //获取图片地址
    function getInputURL(file) {
        var url = null;
        if (window.createObjcectURL != undefined) {
            url = window.createOjcectURL(file);
        } else if (window.URL != undefined) {
            url = window.URL.createObjectURL(file);
        } else if (window.webkitURL != undefined) {
            url = window.webkitURL.createObjectURL(file);
        }
        return url;
    }
    var text = document.getElementById("text");

    autoTextarea(text);// 调用

    function autoTextarea(elem, extra, maxHeight) {

        extra = extra || 0;
        var maxHeight = 0;
        var isFirefox = !!document.getBoxObjectFor || 'mozInnerScreenX' in window,

            isOpera = !!window.opera && !!window.opera.toString().indexOf('Opera'),

            addEvent = function (type, callback) {

                elem.addEventListener ?

                    elem.addEventListener(type, callback, false) :

                    elem.attachEvent('on' + type, callback);

            },

            getStyle = elem.currentStyle ? function (name) {

                var val = elem.currentStyle[name];
                if (name === 'height' && val.search(/px/i) !== 1) {

                    var rect = elem.getBoundingClientRect();

                    return rect.bottom - rect.top -

                        parseFloat(getStyle('paddingTop')) -

                        parseFloat(getStyle('paddingBottom')) + 'px';

                };



                return val;

            } : function (name) {

                return getComputedStyle(elem, null)[name];

            },

            minHeight = parseFloat(getStyle('height'));



        elem.style.resize = 'none';



        var change = function () {

            var scrollTop, height,

                padding = 0,

                style = elem.style;



            if (elem._length === elem.value.length) return;

            elem._length = elem.value.length;



            if (!isFirefox && !isOpera) {

                padding = parseInt(getStyle('paddingTop')) + parseInt(getStyle('paddingBottom'));

            };

            scrollTop = document.body.scrollTop || document.documentElement.scrollTop;



            elem.style.height = minHeight + 'px';

            if (elem.scrollHeight > minHeight) {

                if (maxHeight && elem.scrollHeight > maxHeight) {

                    height = maxHeight - padding;

                    style.overflowY = 'auto';

                } else {

                    height = elem.scrollHeight - padding;

                    style.overflowY = 'hidden';

                };

                style.height = height + extra + 'px';

                scrollTop += parseInt(style.height) - elem.currHeight;

                document.body.scrollTop = scrollTop;

                document.documentElement.scrollTop = scrollTop;

                elem.currHeight = parseInt(style.height);

            };

        };



        addEvent('propertychange', change);

        addEvent('input', change);

        addEvent('focus', change);

        change();

    };
    function boxJson(json) {
        boxJsonArray.push(json);
        addTalk(boxJsonArray, json);
    }
    //修改转账状态
    $("#box").on("click", ".zt_cz>div", function () {
        var obj = $(this).parents().filter(".dc");
        var c = $(this).attr("class");
        var a;
        switch (c) {
            case "zt_gq"://过期
                //修改图片
                obj.find(".zt_img").attr("src", "images/g.png")
                obj.find(".zzDivd").addClass("opacity05");
                //修改名称
                obj.find(".zt-desc").html("已过期")
                a = "gq";
                break;
            case "zt_js"://接收
                obj.find(".zt_img").attr("src", "images/d.png")
                obj.find(".zzDivd").addClass("opacity05");
                obj.find(".zt-desc").html("已被接收")
                var json = getRoleJson();
                json.type = "Transfer";
                json.Transfer = "js";
                json.content = obj.find(".zt-price>span").html();
                var newTalk = createHtml(json)
                insertOrContinue(newTalk, json);
                a = "bjs";
                break;
            case "zt_djs"://等待确认
                obj.find(".zt_img").attr("src", "images/z.png")
                obj.find(".zzDivd").removeClass("opacity05");
                obj.find(".zt-desc").html("等待确认")
                a = "djs";
                break;
            default:
                break;
        }
        for (let index = 0; index < boxJsonArray.length; index++) {
            if (boxJsonArray[index].index == obj.find(".gu").data("index")) {
                console.log(boxJsonArray[index]);
                boxJsonArray[index].Transfer = a;
                updateTempJson(boxJsonArray)
                break;
            }
        }
    })
    function selectJson() {

    }
    //计算字节长度-弃用
    // function getLength() {
    //     if (localStorage.getItem('boxJson') != null && localStorage.getItem('boxJson') != '') {
    //         var str = localStorage.getItem('boxJson');
    //         var length = localStorage.getItem('boxJson').length;
    //         var init = length;
    //         for (var i = 0; i < init; i++) {
    //             if (str.charCodeAt(i) > 255) {
    //                 length++;
    //             }
    //         }
    //         var strLength = length;
    //         var changdu = parseFloat(strLength / 1000).toFixed(2) > 1000 ? parseFloat(strLength / 1000000).toFixed(2) + "MB" : parseFloat(strLength / 1000).toFixed(2) + "KB";
    //         $('.stringLength').html(changdu);
    //     }
    // }
    /**
     * 实时修改聊天记录
     * @param {*} index 
     * @param {*} text 
     */
    function updateBoxOne(index, text) {
        for (let i = 0; i < boxJsonArray.length; i++) {
            if (boxJsonArray[i].index == index) {
                boxJsonArray[i].content = text;
                break;
            }

        }
        updateTempJson(boxJsonArray, index, text).then(res => {

        });
    }
    //点击显示/隐藏头像和名字
    $("#box").on('click', '.divImg', function (e) {

        ShowOrHidden($(this), e);
    })
    //抽出头像显示隐藏方法
    //点击头像
    function ShowOrHidden(obj, e) {

        var tNs = obj.parents().filter(".dc").prev().find(".gu").data("names");
        var tN = obj.parents().filter(".dc").prev().find(".gu").data("name");
        var bNs = obj.parents().filter(".gu").data("names");
        var bN = obj.parents().filter(".gu").data("name");
        var index = obj.parents().filter(".gu").data("index")
        console.log("上一个names:", tNs, "上一个name:", tN);
        console.log("这一个names:", bNs, "这一个name:", bN);
        if (tNs == bNs && bN == tN) {
            if (obj.find("img").is(".width0")) {
                obj.find('.xvb').removeClass("replaceAvatar");
                obj.find('.roleImg').removeClass("width0");
                obj.next().find(".roleNameSpan").removeClass("width0");
                obj.parents().filter(".gu").toggleClass("roleOverallTopMargin");
                obj.next().find(".qp").removeClass("qpW");
                // if(obj.parents().is(".rightRoleOverall")){

                // }else{
                //     obj.next().find(".qp").removeClass("width0");
                // }
            } else {
                obj.find('.roleImg').addClass("width0");
                obj.find(".xvb").addClass("replaceAvatar");
                obj.next().find(".roleNameSpan").addClass("width0");
                //obj.next().find(".qp").addClass("width0");
                obj.parents().filter(".gu").toggleClass("roleOverallTopMargin");
                obj.next().find(".qp").addClass("qpW");
                // if(obj.parents().is(".rightRoleOverall")){

                // }else{
                //     obj.next().find(".qp").addClass("width0");
                // }
            }

        }
    }
    //点击开启移出备选头像队列
    $("#js").click(function () {
        $(this).toggleClass("border2sy");
    })
    function getNowTime() {
        let now = new Date();
        let year = now.getFullYear(); //获取完整的年份(4位,1970-????)
        let month = now.getMonth() + 1; //获取当前月份(0-11,0代表1月)
        let today = now.getDate(); //获取当前日(1-31)
        let hour = now.getHours(); //获取当前小时数(0-23)
        let minute = now.getMinutes(); //获取当前分钟数(0-59)
        let second = now.getSeconds(); //获取当前秒数(0-59)
        let nowTime = ''
        nowTime = year + fillZero(month) + fillZero(today) + fillZero(hour) + fillZero(minute) + fillZero(second)
        return nowTime
    };

    function fillZero(str) {
        var realNum;
        if (str < 10) {
            realNum = '0' + str;
        } else {
            realNum = str;
        }
        return realNum.toString();
    }

    //选中对话触发横线
    $("#box").on('click', '.ipt', function (e) {
        var list = $(":checked[type='checkbox']")
        var that = $(this);
        for (let index = 0; index < $(".ipt").length; index++) {
            if ($(list[index]).is(":checked")) {
                $(list[index]).parents(".dc").addClass("editOpen").siblings().removeClass("editOpen");
                break;
            }
        }
        if ($(this).is(":checked") != true && $(":checked[type='checkbox']").length < 1) {
            $(".dc").removeClass("editOpen");
        }
    })
    //引航者头像点击事件
    $(".YHZTX").click(function () {
        console.log(kqOptions.ab);
    })
    //打开设置
    $("#setOptions").click(function () {
        $(".setOptionsDiv").toggleClass("n");
    })
    //网页全屏
    $("#ALLPM").click(function () {
        $(".bodyN").toggleClass("margin0");
    })
    //#region layui事件
    layui.use(['form', 'laydate', 'util'], function () {
        var layer = layui.layer;
        var form = layui.form;
        form.on('switch(isYHZ)', function (data) {
            // layer.msg('开关 checked：' + (this.checked ? 'true' : 'false'), {
            //     offset: '6px'
            // });
            if (this.checked) {
                $(".YHZTX").removeClass("width0");
                chooseAvatar = {
                    roleId: 1,
                    imgId: 3,
                    path: " images/roleImages/mxr_sf.png",
                    mark: "mxr_sf",
                    name: "米雪儿"
                }
            } else {
                $(".YHZTX").addClass("width0");
                chooseAvatar = {
                    roleId: 9999,
                    // imgId: 3,
                    // path: " images/roleImages/mxr_sf.png",
                    // mark: "mxr_sf",
                    // name: "米雪儿"
                }
            }
            kqOptions.isYHZ = this.checked;



            console.log(kqOptions);
            setOption(kqOptions);
        });
    });
    //#endregion

    //#region 小屏幕时触发事件
    //点击显示/关闭左侧工具栏
    $(".topimg").click(function () {
        var leftObj = $(".left");
        leftObj.is(".disNone") ? leftObj.removeClass("disNone") : leftObj.addClass("disNone")
    })
    //点击显示/关闭角色列表
    $("#qh").click(function () {
        var centerObj = $(".center");
        var rightObj = $(".right");
        // if ($(".center").css("width") == '0') {
        if (centerObj.is(".width00")) {
            centerObj.addClass("width100");
            centerObj.removeClass("width00");
            rightObj.addClass("width00");
            rightObj.removeClass("width100");
        } else {
            centerObj.addClass("width00");
            centerObj.removeClass("width100");
            rightObj.addClass("width100");
            rightObj.removeClass("width00");
        }
    })
    //#endregion
});
